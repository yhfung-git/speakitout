<%# Carousel %>
<%= render "shared/slide" %>

<div class="container home d-flex justify-content-between">
  <%# Category %>
  <div>
    <%= render "shared/category" %>
  </div>

  <%# Middle Posts %>
  <% sorted = {}%>
  <div class="container flex-grow-1 my-3">
    <% @posts.each do |post| %>
      <%= link_to post_path(post) do %>
        <div class="d-flex border p-2 rounded-3 mb-3 posts">
          <div class="me-3">
            <%= post.user.photo.attached? ? (cl_image_tag post.user.photo.key, crop: :fill, class: "rounded-circle avatar me-0") : image_tag(asset_path('https://kitt.lewagon.com/placeholder/users/ssaunier'), class: "rounded-circle avatar me-0") %>
          </div>
          <div>
            <div class="text-muted ">
              <span class="fs-6">Posted by <%= post.user.nickname %></span>
              <span class="mx-1">Â·</span>
              <span><%= time_ago_in_words(post.created_at) %> ago</span>
            </div>
            <p class="mb-0 fw-bold fs-5" ><%= post.title %></p>
            <p class="mb-0" ><%= post.content %></p>
          </div>
        </div>
        <% sorted[post.id] = post.replies.length %>
      <% end %>
    <% end %>
    <div class="pagination" id="bottom">
      <%= will_paginate @posts, :container => false, :params => {:anchor => "bottom"} %>
    </div>
  </div>
  <% sorted = sorted.sort_by {|k, v| v}.reverse.to_h.keys.slice(0, 5) %>
  <div class="collection mt-3 mx-1 text-center">
    <h1 style="text-transform:uppercase">Top <%= sorted.length %> posts</h1>
    <% num = 1 %>
    <% sorted.each do |post_id| %>
    <div><p class="number"><%= num %></p></div>
      <p><%= @posts.where(id: post_id).first.title %></p>
      <% num += 1 %>
    <% end %>
  </div>

</div>
